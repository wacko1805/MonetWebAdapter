<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script>
async function fetchColorsAndSetVariables(url, localFile) {
  const setCSSVariables = (colors) => {
    const root = document.documentElement; 
    for (const [key, value] of Object.entries(colors)) {
      root.style.setProperty(`--${key}`, value);
    }
  };

  const fetchData = async (url) => {
    try {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      const json = await response.json();
      return json.colors;
    } catch (error) {
      console.error('Failed to fetch from URL:', error);
      return null;
    }
  };

  const loadLocalFile = async (filePath) => {
    try {
      const response = await fetch(filePath);
      if (!response.ok) {
        throw new Error('Failed to load local file');
      }
      const json = await response.json();
      return json.colors;
    } catch (error) {
      console.error('Failed to load local file:', error);
      return null;
    }
  };

  const checkUrlAndUpdateColors = async () => {
    let colors = await fetchData(url);
    if (colors) {
      setCSSVariables(colors);
      console.log('Colors updated from URL:', colors);
    } else {
      console.log('Failed to update from URL, retrying in 5 seconds...');
    }

    // Retry the URL check every 5 seconds
    setTimeout(checkUrlAndUpdateColors, 5000); 
  };

  // Load from the local file first
  const localColors = await loadLocalFile(localFile);
  if (localColors) {
    setCSSVariables(localColors);
    console.log('Colors loaded from local file:', localColors);
  }

  // Start checking the URL afterward
  checkUrlAndUpdateColors();
}

const jsonUrl = 'http://192.168.0.17:8192/';
const localFilePath = 'colours.json';

fetchColorsAndSetVariables(jsonUrl, localFilePath);



    </script>

    <style>
        .box {
            border: 2px solid black;
            margin: 5px;
            text-align: center;
            border-radius: 5px;
        }
        .Primary {
            background-color: var(--primary);
        }

        .onPrimary {
            background-color: var(--onPrimary);
        }

        .secondary {
            background-color: var(--secondary);
        }

        .onSecondary {
            background-color: var(--onSecondary);
        }

        .background {
            background-color: var(--background);
        }

        .surface {
            background-color: var(--surface);
        }
    </style>
</head>
<body>
    <div class="example">

        <div class="box Primary">
            <p>Primary</p>
        </div>

        <div class="box onPrimary">
            <p>onPrimary</p>
        </div>

        <div class="box secondary">
            <p>secondary</p>
        </div>

        <div class="box onSecondary">
            <p>onSecondary</p>
        </div>

        <div class="box background">
            <p>background</p>
        </div>

        <div class="box surface">
            <p>surface</p>
        </div>
    </div>
</body>
</html>